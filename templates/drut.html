{% extends "base.html" %}
{% block content %}
<h3>Stan magazynowy DRUTU</h3>
<div class="row mb-2">
  <div class="col-md-6">
    <input id="searchDrut" class="form-control" placeholder="Szukaj (live) — wpisz, aby filtrować...">
  </div>
  <div class="col-md-6 text-end">
    {% if role == 'admin' %}
    <button class="btn btn-success" data-bs-toggle="collapse" data-bs-target="#addForm">Dodaj nowy wpis</button>
    {% endif %}
  </div>
</div>

<div id="addForm" class="collapse mb-3">
  {% if role == 'admin' %}
  <div class="card card-body shadow-sm border">
    <form method="post">

      <div class="row g-3">
        <div class="col-md-4">
          <label for="stan" class="form-label">Stan</label>
          <input id="stan" name="stan" class="form-control" placeholder="Stan">
        </div>
        <div class="col-md-4">
          <label for="srednica_drutu" class="form-label">Średnica drutu [mm]</label>
          <input id="srednica_drutu" name="srednica_drutu" class="form-control" placeholder="Średnica drutu [mm]">
        </div>
        <div class="col-md-4">
          <label for="gatunek_drutu" class="form-label">Gatunek drutu</label>
          <input id="gatunek_drutu" name="gatunek_drutu" class="form-control" placeholder="Gatunek drutu">
        </div>
      </div>

      <div class="row g-3 mt-2">
        <div class="col-md-3">
          <label for="dostawca" class="form-label">Dostawca</label>
          <input id="dostawca" name="dostawca" class="form-control" placeholder="Dostawca">
        </div>
        <div class="col-md-2">
          <label for="ilosc" class="form-label">Ilość</label>
          <input id="ilosc" name="ilosc_szpule_kregi" type="number" min="0" class="form-control" placeholder="Ilość">
        </div>
        <div class="col-md-2">
          <label for="rodzaj" class="form-label">Rodzaj</label>
          <select id="rodzaj" name="rodzaj" class="form-select">
            <option value="">-- wybierz --</option>
            <option value="szpule">Szpule</option>
            <option value="kręgi">Kręgi</option>
          </select>
        </div>
        <div class="col-md-2">
          <label for="waga" class="form-label">Waga szt [kg]</label>
          <input id="waga" name="waga" type="number" step="0.01" min="0" class="form-control" placeholder="Waga szt [kg]">
        </div>
        <div class="col-md-3">
          <label for="suma" class="form-label">Suma [kg]</label>
          <input id="suma" name="suma_kg" class="form-control" placeholder="Suma [kg]" readonly>
        </div>
      </div>

      <div class="row g-3 mt-2">
        <div class="col-md-4">
          <label for="partia_materialu_nr" class="form-label">Partia materiału nr.</label>
          <input id="partia_materialu_nr" name="partia_materialu_nr" class="form-control" placeholder="Partia materiału nr.">
        </div>
        <div class="col-md-4">
          <label for="przewidywana_data_dostawy" class="form-label">Przew. data dostawy</label>
          <input id="przewidywana_data_dostawy" name="przewidywana_data_dostawy" class="form-control" placeholder="Przew. data dostawy">
        </div>
        <div class="col-md-4">
          <label for="przyjecie_materialu" class="form-label">Przyjęcie materiału</label>
          <input id="przyjecie_materialu" name="przyjecie_materialu" class="form-control" placeholder="Przyjęcie materiału">
        </div>
      </div>

      <button class="btn btn-primary mt-3">Dodaj</button>
    </form>
  </div>
  {% endif %}
</div>

<div class="table-responsive">
<table class="table table-striped table-bordered align-middle text-center" id="drutTable">
  <thead class="table-light text-uppercase">
    <tr>
      <th>Stan</th>
      <th>Średnica [mm]</th>
      <th>Gatunek drutu</th>
      <th>Dostawca</th>
      <th>Ilość</th>
      <th>Rodzaj</th>
      <th>Waga szt</th>
      <th>Suma kg</th>
      <th>Partia materiału nr</th>
      <th>Przew. data dostawy</th>
      <th>Przyjęcie</th>
      {% if role=='admin' %}<th>Akcje</th>{% endif %}
    </tr>
  </thead>
  <tbody id="drutBody">
    {% for row in dane %}
    <tr>
      <td>{{ row[1] }}</td>
      <td>{{ row[2] }}</td>
      <td>{{ row[3] }}</td>
      <td>{{ row[4] }}</td>
      <td>{{ row[5] }}</td>
      <td>{{ row[6] }}</td>
      <td>{{ row[7] }}</td>
      <td>{{ row[8] }}</td>
      <td>{{ row[9] }}</td>
      <td>{{ row[10] }}</td>
      <td>{{ row[11] }}</td>
      {% if role=='admin' %}
      <td>
        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#editModal{{ row[0] }}">Edytuj</button>
        <form method="post" action="{{ url_for('drut_delete', record_id=row[0]) }}" style="display:inline;">
          <button class="btn btn-sm btn-danger" onclick="return confirm('Usuń rekord?')">Usuń</button>
        </form>
      </td>
      {% endif %}
    </tr>

    <!-- Modal edycji -->
    <div class="modal fade" id="editModal{{ row[0] }}" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <form method="post" action="{{ url_for('drut_edit', record_id=row[0]) }}">
            <div class="modal-header">
              <h5 class="modal-title">Edytuj rekord</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label">Stan</label>
                  <input type="text" name="stan" value="{{ row[1] }}" class="form-control">
                </div>
                <div class="col-md-4">
                  <label class="form-label">Średnica drutu [mm]</label>
                  <input type="text" name="srednica_drutu" value="{{ row[2] }}" class="form-control">
                </div>
                <div class="col-md-4">
                  <label class="form-label">Gatunek drutu</label>
                  <input type="text" name="gatunek_drutu" value="{{ row[3] }}" class="form-control">
                </div>
                <div class="col-md-3">
                  <label class="form-label">Dostawca</label>
                  <input type="text" name="dostawca" value="{{ row[4] }}" class="form-control">
                </div>
                <div class="col-md-2">
                  <label class="form-label">Ilość</label>
                  <input type="number" name="ilosc_szpule_kregi" id="ilosc-{{ row[0] }}" value="{{ row[5] }}" class="form-control">
                </div>
                <div class="col-md-2">
                  <label class="form-label">Rodzaj</label>
                  <select name="rodzaj" class="form-select">
                    <option value="">-- wybierz --</option>
                    <option value="szpule" {% if row[6]=='szpule' %}selected{% endif %}>Szpule</option>
                    <option value="kręgi" {% if row[6]=='kręgi' %}selected{% endif %}>Kręgi</option>
                  </select>
                </div>
                <div class="col-md-2">
                  <label class="form-label">Waga szt [kg]</label>
                  <input type="number" step="0.01" name="waga" id="waga-{{ row[0] }}" value="{{ row[7] }}" class="form-control">
                </div>
                <div class="col-md-3">
                  <label class="form-label">Suma [kg]</label>
                  <input type="number" step="0.01" name="suma_kg" id="suma-{{ row[0] }}" value="{{ row[8] }}" class="form-control" readonly>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Partia materiału nr.</label>
                  <input type="text" name="partia_materialu_nr" value="{{ row[9] }}" class="form-control">
                </div>
                <div class="col-md-4">
                  <label class="form-label">Przew. data dostawy</label>
                  <input type="date" name="przewidywana_data_dostawy" value="{{ row[10] }}" class="form-control">
                </div>
                <div class="col-md-4">
                  <label class="form-label">Przyjęcie materiału</label>
                  <input type="text" name="przyjecie_materialu" value="{{ row[11] }}" class="form-control">
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
              <button type="submit" class="btn btn-primary">Zapisz zmiany</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    {% endfor %}
  </tbody>
</table>
</div>

<script src="{{ url_for('static', filename='js/drut.js') }}"></script>

{% endblock %}
